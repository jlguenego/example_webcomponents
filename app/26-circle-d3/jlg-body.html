<template id="jlg-body">
	<div>
		<o-select value="[[type]]">
			<select>
				<option value="volvo">Volvo</option>
				<option value="saab">Saab</option>
				<option value="mercedes">Mercedes</option>
				<option value="audi">Audi</option>
			</select>
		</o-select>
		<o-select value="[type]">
				<select>
					<option value="volvo">Volvo</option>
					<option value="saab">Saab</option>
					<option value="mercedes">Mercedes</option>
					<option value="audi">Audi</option>
				</select>
			</o-select>
		Type: {{type}}
		<button onclick="o(this).refresh()">Refresh</button>
		<jlg-bubble-chart data="[data]"></jlg-bubble-chart>
	</div>
</template>

<script>
	class JLGBody extends circle.Element {
		constructor() {
			super();
		}
		refresh() {
			const http = circle.get('http');

			http.get('Table_Ciqual_2016.csv').then((response) => {
				this.model.data = d3.dsvFormat(';').parse(response.data, (d) => {
					// console.log('d', d);
					if (d['ORIGGPCD'] !== '01.2') {
						return;
					}
					const result = {
						id: d['ORIGFDCD'],
						labels: d['ORIGFDNM'].split(/(.{8,}?\s+)/).filter((d) => d !== ''),
						value: +d['Energie, Règlement UE N° 1169/2011 (kcal/100g)'],
						tooltip: `${d['ORIGFDNM']}
${d['Energie, Règlement UE N° 1169/2011 (kcal/100g)'].trim()} kcal/100g`
					};
					// console.log('result', result);
					return result;
				});
			}).catch((error) => {
				console.log('error', error);
			});
		}
	}
	JLGBody.register();

</script>