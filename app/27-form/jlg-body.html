<template id="jlg-body">
	<div>
		<o-choice value="[[type]]" choices="[choices]"></o-choice>
		<o-choice value="[type]" choices="[choices]"></o-choice>
		Type: {{type}}
	</div>
</template>

<script>
	class JLGBody extends circle.Element {
		constructor() {
			super();
			this.refresh();
		}
		refresh() {
			const http = circle.get('http');

			http.get('../data/Table_Ciqual_2016.csv').then((response) => {
				const data = d3.dsvFormat(';').parse(response.data, (d) => {
					return {
						'ORIGGPFR': d['ORIGGPFR'],
						'ORIGGPCD': d['ORIGGPCD']
					}
				}).reduce((result, d) => {
					if (result.indexOf(d['ORIGGPCD']) === -1) {
						result.push(d['ORIGGPCD']);
					}
					return result;
				}, []);
				console.log('data', data);
				this.model.choices = data;
			}).catch((error) => {
				console.log('error', error);
			});
		}
	}
	JLGBody.register();

</script>